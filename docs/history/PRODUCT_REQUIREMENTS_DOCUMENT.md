# 產品需求文件 (Product Requirements Document) - RespiraAlly (要復肺) AI 智慧語音機器人

---

**文件版本 (Document Version):** `v1.0`
**最後更新 (Last Updated):** `2025-10-16`
**主要作者 (Lead Author):** `[AI Reverse-Engineered]`
**審核者 (Reviewers):** `[技術負責人, 設計負責人]`
**狀態 (Status):** `[草稿 (Draft)]`

---

## 目錄 (Table of Contents)

1.  [專案總覽 (Project Overview)](#第-1-部分專案總覽-project-overview)
2.  [商業目標 (Business Objectives) - 「為何做？」](#第-2-部分商業目標-business-objectives---為何做)
3.  [使用者故事與允收標準 (User Stories & UAT) - 「做什麼？」](#第-3-部分使用者故事與允收標準-user-stories--uat---做什麼)
4.  [範圍與限制 (Scope & Constraints)](#第-4-部分範圍與限制-scope--constraints)
5.  [待辦問題與決策 (Open Questions & Decisions)](#第-5-部分待辦問題與決策-open-questions--decisions)

---

**目的**: 本文件旨在逆向工程出現有系統的功能，為 `RespiraAlly` 專案定義其「為何」、「為誰」與「做什麼」，作為後續維護、迭代和交接的唯一事實來源 (Single Source of Truth)。

---

## 第 1 部分：專案總覽 (Project Overview)

| 區塊             | 內容                                                    |
| :--------------- | :------------------------------------------------------ |
| **專案名稱**     | RespiraAlly (要復肺) - AI 智慧語音機器人                |
| **狀態**         | [已上線]                                                |
| **目標發布日期** | [N/A]                                                   |
| **核心團隊**     | PM: [N/A]<br>Lead Engineer: [N/A]<br>UX Designer: [N/A] |

---

## 第 2 部分：商業目標 (Business Objectives) - 「為何做？」

_此部分根據現有功能推斷，旨在還原專案最初的商業動機。_

| 區塊                              | 內容                                                                                                                                                                                                                                             |
| :-------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. 背景與痛點**                 | 慢性阻塞性肺病 (COPD) 等呼吸道疾病患者需要長期自我管理和監測，但傳統方式缺乏即時互動與持續追蹤，導致病患依從性低落，也加重了呼吸治療師的管理負擔。治療師難以即時掌握每位病患的日常狀況，只能在定期回診時獲取片面資訊，無法及時介入處理潛在風險。 |
| **2. 策略契合度**                 | 本專案旨在透過結合 AI 語音互動與 LINE 的高普及率，打造一個創新的數位健康管理平台。它不僅能提升病患自我管理的便利性與參與度，更能賦予治療師高效的個案管理工具，讓他們能即時掌握數據、識別高風險個案，從而提供更精準、個人化的照護。               |
| **3. 成功指標 (Success Metrics)** | _根據 `overview` API 推斷的關鍵指標。_ <br> - **主要指標**: 提升病患依從率 (Average Adherence)。<br> - **次要指標**: 降低高風險病患比例 (High Risk Patients)。<br> - **次要指標**: 提升每日活躍用戶數 (Active Today)。                           |

---

## 第 3 部分：使用者故事與允收標準 (User Stories & UAT) - 「做什麼？」

_此處將使用者分為兩類：**病患 (Patient)** 和 **呼吸治療師 (Therapist)**。_

### 核心史詩 1: 病患個案管理 (Patient Case Management)

| 使用者故事 ID | 描述 (As a, I want to, so that)                                                                                       | 核心允收標準 (UAT)                                                                                                                            |
| :------------ | :-------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------- |
| **US-101**    | **As a** 治療師,<br>**I want to** 登入我的儀表板帳號,<br>**so that** 我可以開始管理我的病患。                         | 1. 使用正確的帳號密碼能成功登入。<br>2. 登入後取得 JWT Token 以進行後續 API 驗證。                                                            |
| **US-102**    | **As a** 治療師,<br>**I want to** 在儀表板上查看所有我管理的病患列表,<br>**so that** 我可以快速掌握所有個案。         | 1. 列表應顯示病患姓名、風險等級等關鍵資訊。<br>2. 支援依風險等級 (high, medium, low) 進行篩選。<br>3. 支援分頁功能。                          |
| **US-103**    | **As a** 治療師,<br>**I want to** 點擊特定病患以查看其詳細健康檔案,<br>**so that** 我可以了解他的個人背景與健康狀況。 | 1. 檔案頁應顯示病患的基本資料（性別、聯絡方式）。<br>2. 顯示其健康檔案（身高、體重、吸菸狀況）。<br>3. 只有該病患的個管師才能查看其詳細資料。 |
| **US-104**    | **As a** 治療師,<br>**I want to** 查看病患的關鍵績效指標 (KPIs),<br>**so that** 我可以評估他的健康趨勢與依從性。      | 1. KPI 應包含最新的 CAT/MMRC 問卷分數。<br>2. 顯示指定時間範圍內的依從性統計。                                                                |

### 核心史詩 2: 病患 LINE LIFF 應用 (Patient LIFF Application)

| 使用者故事 ID | 描述 (As a, I want to, so that)                                                                                  | 核心允收標準 (UAT)                                                                                                               |
| :------------ | :--------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- |
| **US-201**    | **As a** 新病患,<br>**I want to** 透過 LINE LIFF 應用完成註冊,<br>**so that** 我可以開始使用服務。               | 1. 使用 LINE User ID 進行註冊。<br>2. 需填寫姓名、性別、聯絡電話與基本健康資料。<br>3. 註冊成功後，帳號自動綁定 LINE Rich Menu。 |
| **US-202**    | **As a** 已註冊病患,<br>**I want to** 登入 LIFF 應用,<br>**so that** 我可以存取我的健康管理工具。                | 1. 透過 LINE User ID 自動登入。<br>2. 登入成功後取得 JWT Token。                                                                 |
| **US-203**    | **As a** 病患,<br>**I want to** 每日填寫健康日誌,<br>**so that** 我可以記錄我的飲水、用藥、運動和吸菸狀況。      | 1. 每日只能新增一筆紀錄。<br>2. 可更新當日的紀錄。<br>3. 介面應簡單易用。                                                        |
| **US-204**    | **As a** 病患,<br>**I want to** 填寫 CAT 與 MMRC 問卷,<br>**so that** 治療師可以了解我的呼吸困難程度與生活品質。 | 1. LIFF 應用提供專門的問卷頁面。<br>2. 提交後分數會記錄至後端。                                                                  |

### 核心史詩 3: AI 語音互動 (AI Voice Interaction)

| 使用者故事 ID | 描述 (As a, I want to, so that)                                                                                         | 核心允收標準 (UAT)                                                                                                                                                                  |
| :------------ | :---------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **US-301**    | **As a** 病患,<br>**I want to** 透過 LIFF 應用錄製語音訊息並發送給 AI 機器人,<br>**so that** 我可以方便地諮詢健康問題。 | 1. 語音檔案成功上傳至後端。<br>2. 後端將任務發送至 AI Worker 進行處理。                                                                                                             |
| **US-302**    | **As an** AI Worker,<br>**I want to** 處理語音任務,<br>**so that** 我可以生成語音回應給病患。                           | 1. **STT**: 準確地將語音轉為文字。<br>2. **LLM**: 根據文字內容生成有幫助的回應。<br>3. **TTS**: 將回應文字轉為自然的語音。<br>4. 處理完成後，將結果（包含語音 URL）通知 `web-app`。 |
| **US-303**    | **As a** 病患,<br>**I want to** 在 LIFF 應用中收到並播放 AI 的語音回覆,<br>**so that** 我可以獲得即時的健康建議。       | 1. `web-app` 透過 WebSocket 將 AI Worker 的處理結果即時推送至前端。<br>2. 前端能自動播放收到的語音回覆。                                                                            |

---

## 第 4 部分：範圍與限制 (Scope & Constraints)

_此處定義了根據現有程式碼庫推斷出的系統邊界。_

| 區塊                        | 內容                                                                                                                                                                                                                                                             |
| :-------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **功能性需求 (In Scope)**   | - **治療師儀表板**: 病患列表、個案詳情、KPI 總覽、趨勢分析。<br>- **病患 LIFF 應用**: LINE 註冊/登入、每日健康日誌、CAT/MMRC 問卷、AI 語音對話。                                                                                                                 |
| **非功能性需求 (NFRs)**     | - **安全性**: 使用 JWT (JSON Web Tokens) 進行 API 授權，並包含角色基礎的存取控制。<br>- **異步處理**: AI 語音任務透過 RabbitMQ 進行異步處理，避免長時間等待。<br>- **容器化**: 所有服務 (`web-app`, `ai-worker`, `postgres`, `nginx`) 皆透過 Docker 容器化部署。 |
| **不做什麼 (Out of Scope)** | - 不支援治療師透過 LINE 登入。<br>- 不支援病患使用帳號密碼登入。<br>- 不支援文字訊息的即時聊天功能 (僅支援語音)。<br>-儀表板目前沒有病患資料的匯出功能。                                                                                                         |
| **假設與依賴**              | - **假設**: 所有病患皆有 LINE 帳號並熟悉 LIFF 操作。<br>- **依賴**: <br> - 依賴 LINE Platform 提供 LIFF 環境與使用者認證。<br> - 依賴外部的 STT, LLM, TTS 服務 (或自行部署的模型)。<br> - 依賴 RabbitMQ 進行服務間的訊息傳遞。                                   |

---

## 第 5 部分：待辦問題與決策 (Open Questions & Decisions)

_記錄已做出的關鍵技術決策，並提出待釐清的問題。_

| 問題/決策 ID | 描述                                                                                                                                   | 狀態     | 負責人        |
| :----------- | :------------------------------------------------------------------------------------------------------------------------------------- | :------- | :------------ |
| **D-001**    | 決定採用 PostgreSQL 作為主要資料庫。                                                                                                   | [已決定] | Lead Engineer |
| **D-002**    | 決定採用 Flask (Python) 作為後端 API (`web-app`) 框架。                                                                                | [已決定] | Lead Engineer |
| **D-003**    | 決定採用 RabbitMQ 作為 `web-app` 與 `ai-worker` 之間的訊息佇列。                                                                       | [已決定] | Lead Engineer |
| **Q-001**    | `web_dashboard` 的前端原始碼遺失，僅存在 `build` 產物。是否需要從 `build` 檔案逆向工程或根據 API 重建？                                | [待討論] | Lead Engineer |
| **Q-002**    | 目前 `patients.py` 中有 TODO 註記，表示 `last_cat_score` 和 `last_mmrc_score` 待問卷模型完成後補上。需要確認問卷數據流是否已完整實現。 | [待討論] | Lead Engineer |
| **Q-003**    | `ai-worker` 中使用的 STT/LLM/TTS 服務是外部 API 還是內部模型？其規格與限制為何？                                                       | [待釐清] | Lead Engineer |
