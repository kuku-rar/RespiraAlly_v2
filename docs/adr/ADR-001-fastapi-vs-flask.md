# ADR-001: 採用 FastAPI 作為後端框架

---

**狀態 (Status):** `已接受 (Accepted)`

**決策者 (Deciders):** `[技術負責人, 開發團隊]`

**日期 (Date):** `2025-10-10`

---

## 1. 背景與問題陳述 (Context and Problem Statement)

*   **上下文 (Context):** `RespiraAlly V1` 使用 Flask 作為後端框架。在規劃 `V2` 時，我們需要重新評估後端技術選型，以更好地支持未來的產品功能，如即時通訊 (WebSocket)、高效能 AI 推理接口、以及更嚴格的型別約束來提高程式碼品質。
*   **問題陳述 (Problem Statement):** 現有的 Flask 架構原生不支持異步處理，難以高效應對 AI 語音等 I/O 密集型任務。此外，手動維護 API 文件和缺乏內建資料驗證機制，已導致開發效率下降和潛在的運行時錯誤。
*   **驅動因素/約束條件 (Drivers / Constraints):**
    *   **驅動因素 1:** 性能需求：AI 語音處理需要高效的 I/O 處理能力。
    *   **驅動因素 2:** 開發效率：需要自動化的 API 文件生成與強大的資料驗證。
    *   **驅動因素 3:** 型別安全：希望引入靜態型別檢查以提高程式碼可維護性。
    *   **約束條件 1:** 團隊成員主要為 Python 開發者，應繼續沿用 Python 生態。

## 2. 考量的選項 (Considered Options)

### 選項一：繼續使用 Flask

*   **描述：** 維持現有技術棧，並透過擴充套件 (如 Flask-SocketIO) 來增加異步等功能。
*   **優點 (Pros)：**
    *   團隊熟悉，無學習成本。
    *   生態系成熟穩定。
*   **缺點 (Cons)：**
    *   原生非異步，異步支援不如新生代框架完善。
    *   API 文件和資料驗證需依賴第三方工具，整合度較差，程式碼較繁瑣。
*   **成本/複雜度評估:** 開發成本低，但長期維護複雜度高。

### 選項二：遷移至 FastAPI

*   **描述：** 採用基於 Starlette 和 Pydantic 的現代 Python 異步框架。
*   **優點 (Pros)：**
    *   **高性能**: 原生支援 `async/await`，適合 I/O 密集型應用。
    *   **高開發效率**: 自動生成 API 文件、內建基於型別提示的資料驗證。
    *   **現代化**: 完美整合 Python 3.7+ 的型別提示特性。
*   **缺點 (Cons)：**
    *   團隊需要投入時間學習新框架。
    *   生態系相較 Flask 較新。
*   **成本/複雜度評估:** 初期學習成本中等，但長期開發與維護複雜度低。

### 選項三：遷移至 Django

*   **描述：** 採用功能全面的「全家桶」式 Python 框架。
*   **優點 (Pros)：**
    *   功能豐富，內建 ORM、Admin 後台等。
    *   社群龐大，安全性高。
*   **缺點 (Cons)：**
    *   框架較重，不符合微服務的輕量化原則。
    *   異步支援 (Django Channels) 的整合度不如 FastAPI。
*   **成本/複雜度評估:** 學習成本高，且與專案架構目標不符。

---

## 3. 決策 (Decision Outcome)

**最終選擇的方案：** `選項二：遷移至 FastAPI`。

**選擇理由 (Rationale):**
FastAPI 在性能、開發效率和現代 Python 特性上的優勢，完全契合 V2 的架構目標。雖然存在學習成本，但其帶來的長期效益（如更高的可維護性、內建的 API 文件與驗證）遠超過初期投入。相較於 Flask，它能從根本上解決異步和資料驗證的問題；相較於 Django，它更輕量，更適合微服務架構。

我們將採用「雙軌並行，逐步遷移」的策略，新服務使用 FastAPI 開發，並逐步將 V1 的核心功能遷移過來。

---

## 4. 決策的後果與影響 (Consequences)

*   **正面影響 / 預期收益：**
    *   開發團隊將掌握一個現代、高效的 Web 框架。
    *   API 將擁有自動、即時更新的文件，降低前後端溝通成本。
    *   系統整體的性能與穩定性將得到提升。
*   **負面影響 / 引入的風險：**
    *   初期 Sprint 需要投入時間進行團隊培訓與建立 FastAPI 專案範本。
    *   在過渡期內，需要同時管理 Flask 與 FastAPI 服務的部署與維護。
*   **未來可能需要重新評估的觸發條件：**
    *   如果 FastAPI 的發展停滯，或出現更優越的 Python 異步框架，可重新評估。
