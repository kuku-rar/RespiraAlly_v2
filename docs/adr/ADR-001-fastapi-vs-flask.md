# ADR-001: 採用 FastAPI 作為後端框架

**狀態**: 已決定 (Accepted)

**日期**: 2025-10-10

## 背景 (Context)

RespiraAlly V1 使用 Flask 作為後端框架。在規劃 V2 時，我們需要重新評估後端技術選型，以更好地支持未來的產品功能，如即時通訊 (WebSocket)、高效能 AI 推理接口、以及更嚴格的型別約束來提高程式碼品質。

## 決策驅動力 (Decision Drivers)

*   **性能需求**: AI 語音處理等功能需要高效的 I/O 處理能力，異步框架是更佳選擇。
*   **開發效率**: 隨著專案複雜度增加，需要自動化的 API 文件生成與強大的資料驗證機制。
*   **型別安全**: 引入靜態型別檢查能顯著減少運行時錯誤，提高大型專案的可維護性。
*   **團隊技能**: 團隊成員主要為 Python 開發者，希望繼續沿用 Python 生態。

## 考量的方案 (Considered Options)

### 方案 1: 繼續使用 Flask

*   **優點**:
    *   團隊熟悉，無學習成本。
    *   生態系成熟穩定。
    *   可透過 Flask-SocketIO 等擴充套件支援異步功能。
*   **缺點**:
    *   原生非異步，異步支援不如新生代框架完善。
    *   API 文件需依賴第三方工具 (如 Flasgger)，整合度較差。
    *   資料驗證需自行整合 (如 Marshmallow)，程式碼較繁瑣。

### 方案 2: 遷移至 FastAPI (最終選擇)

*   **優點**:
    *   **高性能**: 基於 Starlette 和 Pydantic，是最高性能的 Python 框架之一。
    *   **原生異步**: 從底層支援 `async/await`，非常適合 I/O 密集的應用。
    *   **開發效率高**:
        *   基於 Pydantic 的自動請求/回應資料驗證。
        *   自動生成 OpenAPI (Swagger) 和 ReDoc API 文件。
        *   依賴注入系統簡化了程式碼結構。
    *   **現代 Python 特性**: 完全擁抱 Python 3.7+ 的型別提示 (Type Hints)。
*   **缺點**:
    *   團隊需要時間學習新框架。
    *   生態系相較 Flask 較新（但發展迅速）。

### 方案 3: 遷移至 Django

*   **優點**:
    *   功能全面的全家桶框架，內建 ORM、Admin 後台等。
    *   安全性高，社群龐大。
*   **缺點**:
    *   框架較重，對於微服務架構來說過於龐大。
    *   異步支援 (Django Channels) 相較 FastAPI 整合度較差。
    *   不符合我們敏捷、輕量的微服務選型原則。

## 決策 (Decision)

我們決定選擇 **方案 2: 遷移至 FastAPI**。

FastAPI 在性能、開發效率和現代 Python 特性上的優勢，完全契合 V2 的架構目標。雖然存在學習成本，但其帶來的長期效益（如更高的可維護性、內建的 API 文件與驗證）遠超過初期投入。我們將採用「雙軌並行，逐步遷移」的策略，新服務使用 FastAPI 開發，並逐步將 V1 的核心功能遷移過來。

## 後果 (Consequences)

*   **正面**:
    *   開發團隊將掌握一個現代、高效的 Web 框架。
    *   API 將擁有自動、即時更新的文件，降低溝通成本。
    *   系統性能與穩定性將得到提升。
*   **負面**:
    *   初期 Sprint 需要投入時間進行團隊培訓與建立 FastAPI 專案範本。
    *   需要管理 Flask 與 FastAPI 服務並存的過渡期。
