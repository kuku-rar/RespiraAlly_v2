# Sprint 1 回顧日誌 (Sprint 1 Retrospective)

**Sprint 編號**: Sprint 1
**時間範圍**: 2025-10-21 ~ 2025-11-03 (Week 1-2)
**Sprint 目標**: 建立可運行的專案骨架,完成基礎設施與認證系統
**記錄者**: TaskMaster Hub
**記錄日期**: 待更新 (Sprint 結束時填寫)

---

## 📊 Sprint 概覽 (Sprint Overview)

| 項目 | 內容 |
|------|------|
| **Sprint 目標** | 建立可運行的專案骨架,完成 Docker 環境、資料庫 Schema、FastAPI 結構與雙角色認證系統 |
| **規劃工時** | 104h |
| **實際工時** | 待更新 |
| **完成率** | 待更新 |
| **團隊成員** | Backend Lead, Frontend Lead, DevOps Engineer |

---

## 🎯 Sprint 目標達成狀況 (Goal Achievement)

### 目標 1: Docker Compose 環境建置
- **狀態**: 待更新
- **完成度**: 0%
- **說明**: PostgreSQL, Redis, RabbitMQ, MinIO 容器化配置

### 目標 2: 資料庫 Schema + Phase 0 核心索引
- **狀態**: 待更新
- **完成度**: 0%
- **說明**: Alembic Migration + 核心表 + 4 個必要索引

### 目標 3: FastAPI 專案結構
- **狀態**: 待更新
- **完成度**: 0%
- **說明**: Clean Architecture 目錄結構 + Database Session + 錯誤處理

### 目標 4: JWT 認證系統 (含 Token 黑名單與刷新機制)
- **狀態**: 待更新
- **完成度**: 0%
- **說明**: 雙角色認證 (Patient LINE / Therapist Email) + Redis 黑名單 + Token 刷新端點

### 目標 5: 前端基礎架構
- **狀態**: 待更新
- **完成度**: 0%
- **說明**: Next.js Dashboard + Vite LIFF + 登入/註冊頁面

---

## ✅ 完成的任務 (Completed Tasks)

### WBS 任務清單

> **注意**: 此部分在 Sprint 結束時填寫。參考 [WBS Sprint 1](../../16_wbs_development_plan.md#30-sprint-1-基礎設施--認證系統-104h--v29-8h-week-1-2)

| 任務編號 | 任務名稱 | 負責人 | 規劃工時 | 實際工時 | 狀態 | 備註 |
|---------|---------|--------|----------|----------|------|------|
| - | 待更新 | - | - | - | - | - |

**總計**: 待統計

### 主要交付物

> **注意**: 此部分在 Sprint 結束時填寫

1. **Docker Compose 環境**
   - 類型: 配置
   - 產出: 待更新
   - 驗收標準: 待驗證

2. **資料庫 Schema + 索引**
   - 類型: Migration
   - 產出: 待更新
   - 驗收標準: 待驗證

3. **JWT 認證 API**
   - 類型: 代碼
   - 產出: 待更新
   - 驗收標準: 待驗證

4. **登入/註冊頁面**
   - 類型: 前端
   - 產出: 待更新
   - 驗收標準: 待驗證

---

## ⚠️ 未完成的任務 (Incomplete Tasks)

> **注意**: 此部分在 Sprint 結束時填寫

| 任務編號 | 任務名稱 | 負責人 | 規劃工時 | 已投入 | 狀態 | 未完成原因 | 處理方案 |
|---------|---------|--------|----------|--------|------|-----------|---------|
| - | 待更新 | - | - | - | - | - | - |

---

## 🔥 Sprint 亮點 (Highlights)

> **注意**: 此部分在 Sprint 結束時填寫

### 技術突破
- 待更新

### 流程改進
- 待更新

### 團隊協作
- 待更新

---

## 🐛 遇到的問題 (Issues & Challenges)

> **注意**: 此部分在 Sprint 結束時填寫,可在 Sprint 執行過程中持續記錄

### 技術問題

#### 問題記錄區 (持續更新)
<!-- 在 Sprint 執行過程中遇到問題時記錄於此 -->

### 流程問題

#### 問題記錄區 (持續更新)
<!-- 在 Sprint 執行過程中遇到流程問題時記錄於此 -->

---

## 📈 指標與數據 (Metrics & Data)

> **注意**: 此部分在 Sprint 結束時填寫

### 工時統計

| 類別 | 規劃工時 | 實際工時 | 差異 | 差異率 |
|------|----------|----------|------|--------|
| 環境建置 | 20h | 待更新 | - | - |
| 資料庫實作 | 19h | 待更新 | - | - |
| FastAPI 結構 | 16h | 待更新 | - | - |
| 認證系統 | 37h | 待更新 | - | - |
| 前端架構 | 20h | 待更新 | - | - |
| **總計** | **104h** | **待更新** | **-** | **-** |

### 代碼統計

| 指標 | 數值 |
|------|------|
| 新增代碼行數 | 待更新 |
| 刪除代碼行數 | 待更新 |
| 淨增長 | 待更新 |
| 新增測試覆蓋率 | 待更新 |
| PR 合併數量 | 待更新 |
| 代碼審查平均時間 | 待更新 |

### 品質指標

| 指標 | 數值 | 目標 | 達成 |
|------|------|------|------|
| 單元測試通過率 | 待更新 | ≥90% | - |
| 代碼覆蓋率 | 待更新 | ≥80% | - |
| CI 成功率 | 待更新 | ≥95% | - |
| 發現的 Bug 數量 | 待更新 | - | - |
| 修復的 Bug 數量 | 待更新 | - | - |

---

## 🎓 經驗教訓 (Lessons Learned)

> **注意**: 此部分在 Sprint Review/Retro 會議中討論並記錄

### 做得好的地方 (What Went Well)
1. 待更新

### 需要改進的地方 (What Needs Improvement)
1. 待更新
   - **行動項**: 待定

### 下次要嘗試的做法 (What to Try Next)
1. 待更新

---

## 🚀 下個 Sprint 規劃 (Next Sprint Planning)

> **注意**: 此部分在 Sprint 結束時,規劃 Sprint 2 時填寫

### 遺留任務
- 待更新

### 技術債務
- 待更新

### 改進行動項
- 待更新

---

## 📝 Sprint 執行日誌 (Daily Log)

> **使用說明**: 在 Sprint 執行過程中,每日或每週記錄重要事項

### Sprint 前準備 (2025-10-20)

#### 2025-10-20 - Task 3.2 資料庫實作完成 ✅

**完成任務**: Sprint 1 Task 3.2 - 資料庫實作 (所有 6 個子任務)

**主要成果**:
1. ✅ Alembic 初始化完成 (3.2.1)
2. ✅ 核心資料表 SQLAlchemy Models 建立 (3.2.2):
   - users, patient_profiles, therapist_profiles
   - daily_logs, survey_responses, event_logs
3. ✅ Repository 介面定義完成 (3.2.3) - 8 個 Repository 介面
4. ✅ Migration Scripts 生成 (3.2.4) - `2025_10_20_0110-2c0639c3091b`
5. ✅ Migration 執行與驗證成功 (3.2.5) - 7 張表 + 16 個索引
6. ✅ Phase 0 核心索引建立 (3.2.6) - 4 個高頻查詢索引

**技術突破**:
- PostgreSQL 15 + pgvector v0.8.1 環境成功建立
- 雙角色認證設計 (Patient LINE / Therapist Email) 的 Check Constraints 實作
- Alembic autogenerate 問題修正 (sa.text() + JSONB literals)

**遇到的問題與解決**:
1. **PostgreSQL 認證失敗**:
   - 原因: Port 映射錯誤 (5432 vs 15432)
   - 解決: 用戶協助修正 docker-compose.yml,更新 backend/.env

2. **Migration SQL 語法錯誤**:
   - 問題 1: `gen_random_uuid()` 未用 sa.text() 包裝
   - 問題 2: JSONB 預設值缺少引號 (`'{}'::jsonb` vs `{}'::jsonb`)
   - 解決: 使用 sed 批次修正 + 手動修正 JSONB 欄位

**驗證結果**:
- 資料庫連接測試: ✅ 通過
- Migration 執行: ✅ 成功 (< 2s, 0 errors)
- Schema 驗證: ✅ 7 tables, 16 indexes 正確創建

**Git Commit**: `20902a6` - "feat(database): complete Task 3.2 - initial schema + migration"

**工時統計**:
- 規劃工時: 21h (3.2.1~3.2.6)
- 實際工時: 約 21h (含問題排查)

**下一步**:
- Task 3.3: FastAPI 專案結構建立 (16h)
- 預計開始: 2025-10-20 或 2025-10-21

---

#### 2025-10-20 - Task 3.3 FastAPI 專案結構完成 ✅

**完成任務**: Sprint 1 Task 3.3 - FastAPI 專案結構 (所有 8 個子任務)

**主要成果**:
1. ✅ uv 專案初始化 (3.3.1) - 2h
2. ✅ Clean Architecture 目錄結構 (3.3.2) - 3h
   - 4 層架構: api/application/domain/infrastructure
   - 7 個 Bounded Context: auth/daily_log/patient/survey/risk/rag/notification
3. ✅ FastAPI main.py 入口點 (3.3.3) - 2h
   - Lifespan 事件管理
   - API 文檔配置 (/api/docs, /api/redoc)
4. ✅ Database Session 管理 (3.3.4) - 3h
   - AsyncSession + async_sessionmaker
   - get_db() dependency
5. ✅ Pydantic Settings 配置加載 (3.3.5) - 2h
   - 支援本地開發與 Zeabur 部署
   - 環境變數自動解析
6. ✅ **全域錯誤處理 Middleware (3.3.6) - 2h** 🎯
   - 三層例外架構 (Domain/Application/HTTP)
   - 18 個例外處理器註冊
   - 統一 JSON 錯誤回應格式
7. ✅ CORS Middleware 配置 (3.3.7) - 1h
8. ✅ /health Endpoint 實作 (3.3.8) - 1h

**技術突破**:
- Clean Architecture 三層例外分層設計
- 18 個全域例外處理器註冊成功
- 統一錯誤回應格式 (type, message, timestamp, details)
- FastAPI TestClient 測試驗證 100% 通過

**交付物**:
- ✅ `domain/exceptions/domain_exceptions.py` (80 行)
- ✅ `core/exceptions/application_exceptions.py` (96 行)
- ✅ `core/exceptions/http_exceptions.py` (280 行)
- ✅ `main.py` 更新 (+52 行)
- ✅ 測試驗證: 5 個測試案例全部通過

**測試結果**:
| 測試案例 | 狀態碼 | 結果 |
|---------|--------|------|
| ValidationError | 400 | ✅ |
| ResourceNotFoundError | 404 | ✅ |
| RequestValidationError | 422 | ✅ |
| 正常請求 | 200 | ✅ |
| Health Check | 200 | ✅ |

**Git Commit**: `f2f67a8` - "feat(api): complete Task 3.3.6 - Global Exception Handling Middleware"

**工時統計**:
- 規劃工時: 16h (3.3.1~3.3.8)
- 實際工時: 16h
- 完成度: 100%

**下一步**:
- Task 3.4: 認證授權系統 (37h)
- 預計開始: 2025-10-20 (下午)

---

### Week 1 (2025-10-21 ~ 2025-10-27)

#### 2025-10-21 (Day 1) - Sprint Planning
- **完成**: Sprint 1 Planning 會議
- **決策**: 待記錄
- **問題**: 無
- **明日計劃**: 待記錄

<!-- 繼續記錄每日進度... -->

### Week 2 (2025-10-28 ~ 2025-11-03)

<!-- 繼續記錄每日進度... -->

---

## 📎 相關文件連結 (Related Documents)

- [WBS Sprint 1 任務清單](../../16_wbs_development_plan.md#30-sprint-1-基礎設施--認證系統-104h--v29-8h-week-1-2)
- [JWT 認證設計文檔](../../security/jwt_authentication_design.md)
- [索引策略規劃文檔](../../database/index_strategy_planning.md)
- [數據庫 Schema 設計](../../database/schema_design_v1.0.md)
- [Sprint 1 Planning 會議記錄](../meetings/sprint_1_planning.md) (待建立)
- [Sprint 1 Review 會議記錄](../meetings/sprint_1_review.md) (待建立)

---

**記錄者**: TaskMaster Hub
**審核者**: Technical Lead
**記錄日期**: 2025-10-21 (Sprint 開始時建立)
**審核日期**: 待更新 (Sprint 結束時)
